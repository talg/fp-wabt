WABT_ROOT=../../..
WASM2C=$(WABT_ROOT)/bin/wasm2c

WASM2C_RUNTIME_PATH=$(WABT_ROOT)/wasm2c/
WASM2C_RUNTIME_FILES=$(addprefix $(WASM2C_RUNTIME_PATH), wasm-rt-impl.c uvwasi-rt.c)

UVWASI_PATH=$(WABT_ROOT)/third_party/uvwasi

DEPS=-I$(UVWASI_PATH)/include -L$(WABT_ROOT)/build/_deps/libuv-build -L$(WABT_ROOT)/build/third_party/uvwasi

LIBS=-luvwasi_a -luv_a -lpthread -ldl -lm

DBG_FLAGS=-g
REL_FLAGS=-O3 -flto -fomit-frame-pointer -fno-stack-protector

CFLAGS=$(REL_FLAGS)

all: input.elf

clean:
	rm -rf $(ALL_RESULTS) input.*

input.c:
	$(WASM2C) input.wasm -o input.c

input.elf: input.c  uvwasi-rt-main.c $(WASM2C_RUNTIME_FILES)
	$(CC) $(CFLAGS) input.c uvwasi-rt-main.c -o input.elf -I$(WASM2C_RUNTIME_PATH) $(WASM2C_RUNTIME_FILES) $(DEPS) $(LIBS)
